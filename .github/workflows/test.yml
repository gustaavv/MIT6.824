name: Run lab tests

on:
  push:
    branches:
      - master
    paths:
      - "src/**"
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - name: Lab 1
            command: cd src/main && bash test-mr.sh
          - name: Lab 2A
            command: cd src/raft && time go test -run 2A -race
          - name: Lab 2B
            command: cd src/raft && time go test -run 2B -race
          - name: Lab 2C
            command: cd src/raft && time go test -run 2C -race

      fail-fast: false

    name: "Test: ${{ matrix.name }}"

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: 1.15

      - name: Run tests
        run: ${{ matrix.command }}
